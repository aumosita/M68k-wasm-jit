# 68k → WASM JIT Compiler

**고정밀 사이클 정확도의 고성능 68020 에뮬레이터**

Motorola 68020 바이너리를 런타임에 WebAssembly로 변환하여 실행하는 사이클 정확 에뮬레이터.

## 프로젝트 목표

**최우선 목표**: **Motorola 68020 전체 스펙 100% 구현**

1. **68020 완전 구현** (최최우선)
   - 모든 명령어 (100개+ 명령어, 모든 변형)
   - 모든 어드레싱 모드 (18가지 EA 모드)
   - 모든 예외 처리
   - 특권/사용자 모드
   - 모든 시스템 레지스터

2. **사이클 정확도** (최우선)
   - 모든 명령어의 정확한 실행 시간 (사이클 단위)
   - 68020 공식 스펙 준수
   - EA 모드 사이클 포함

3. **고성능** (중요)
   - WASM JIT 컴파일을 통한 네이티브의 80-95% 성능
   - 사이클 정확도를 유지하면서

**중요**: 68000이 아닌 68020, "거의 완전"이 아닌 100% 완전 구현이 목표!

**제외**: FPU (68881/68882 코프로세서) - 정수 연산 CPU 코어만 구현

## 왜 JIT 방식인가?

기존 인터프리터 방식은 느리고, 정적 컴파일은 Zig 컴파일 타임이 병목.  
→ **런타임 JIT**로 즉시 변환 + 브라우저 JIT로 네이티브 수준 성능 달성!

## 구조

```
68k Binary (ROM/Executable)
    ↓
[JIT Compiler]
 - Decode 68k instructions
 - Translate to WASM bytecode
 - Generate WASM module
    ↓
WASM Module (동적 생성)
    ↓
Browser JIT (V8/SpiderMonkey)
    ↓
Native Execution (x86_64/ARM64)
```

## 핵심 아이디어

### ❌ 기존 방식 (느림)
```
68k source → Zig 컴파일 → 네이티브
           (컴파일 타임 병목)
```

### ✅ 새 방식 (빠름)
```
68k binary → 런타임 JIT → WASM → 브라우저 JIT → 네이티브
           (즉시 실행)
```

## 성능 목표

- **사이클 정확도**: 각 명령어의 정확한 사이클 카운트 (68020 스펙 준수)
- **컴파일 속도**: 1MB 68k 바이너리를 0.1초 이내에 WASM 변환
- **실행 속도**: 네이티브의 80-95%
- **메모리**: 원본 68k 바이너리의 2-3배

## 상태

✅ **Alpha 단계** - 2026-02-12 최신

### 현재 구현 현황
| 카테고리 | 구현 | 디코딩 | 진행률 |
|---------|------|--------|--------|
| 논리 연산 | 7/8 | ✅ 7/7 | 88% |
| 시프트/로테이트 | 6/8 | ✅ 6/6 | 75% |
| 산술 연산 | 23/25 | ✅ 23/23 | **92%** |
| 데이터 이동 | 11/18 | ✅ 11/11 | 61% |
| 비트 조작 | 5/13 | ✅ 5/5 | 38% |
| 프로그램 제어 | 1/35 | ✅ 1/1 | 3% |
| **전체** | **53/164** | ✅ **53/53** | **32%** |

### 🎉 최근 성과
- ✅ **Decoder 100% 달성** - 모든 구현 명령어가 정상 디코딩
- ✅ **포괄적 테스트** - 46/46 자동 테스트 통과
- ✅ **빌드 시스템** - Zig 0.13.0 완전 지원

### 빌드 및 테스트
```bash
# 빌드
zig build

# 테스트 실행
./zig-out/bin/test-jit

# 포괄적 테스트
zig build test-comprehensive
```

### 다음 작업
1. **프로그램 제어** - BRA, BSR, Bcc, JMP, JSR, RTS
2. **데이터 이동 완성** - MOVEM, LINK/UNLK 완전 구현
3. **실제 68k 코드 테스트**

---

**작성자**: 김서방  
**시작일**: 2026-02-09  
**마지막 업데이트**: 2026-02-12 18:00
