# 2026-02-12 - m68k-wasm-jit í”„ë¡œì íŠ¸ ì‹œì‘

## ë°°ê²½

**ë¬¸ì œ**: Zig ì»´íŒŒì¼ íƒ€ì„ì´ ë³‘ëª©  
**í•´ê²°**: 68k ë°”ì´ë„ˆë¦¬ë¥¼ ëŸ°íƒ€ì„ì— WASMìœ¼ë¡œ JIT ë³€í™˜

## í”„ë¡œì íŠ¸ ëª©í‘œ

68k â†’ WASM JIT ì»´íŒŒì¼ëŸ¬ êµ¬í˜„

### í•µì‹¬ ì•„ì´ë””ì–´
```
68k ë°”ì´ë„ˆë¦¬
  â†“ ëŸ°íƒ€ì„ ë³€í™˜ (ì¦‰ì‹œ)
WASM ì½”ë“œ
  â†“ ë¸Œë¼ìš°ì € JIT
ë„¤ì´í‹°ë¸Œ ì‹¤í–‰
```

## ì˜¤ëŠ˜ ì‘ì—…

### 1. í”„ë¡œì íŠ¸ ìƒì„± âœ…
- ë””ë ‰í† ë¦¬: `m68k-wasm-jit`
- README, PLAN, SPEC, build.zig

### 2. WASM Bytecode Generator (wasm_builder.zig) âœ…
- `ModuleBuilder`: WASM ëª¨ë“ˆ ìƒì„±
- `FunctionBuilder`: í•¨ìˆ˜ ì½”ë“œ ìƒì„±
- Opcode ì •ì˜ (i32.const, local.get/set, add, sub ë“±)
- LEB128 ì¸ì½”ë”©
- **300ì¤„**

### 3. 68k Decoder (decoder.zig) âœ…
- Pipeline í”„ë¡œì íŠ¸ì—ì„œ ì´ì‹ + ê°„ì†Œí™”
- ê¸°ë³¸ ëª…ë ¹ì–´ ë””ì½”ë”©
  - MOVEQ, MOVE, ADD, SUB
  - AND, OR, EOR
  - BRA, Bcc, RTS
  - NOP
- **450ì¤„**

### 4. Translator (translator.zig) âœ…
- 68k â†’ WASM ë³€í™˜
- êµ¬í˜„ëœ ëª…ë ¹ì–´:
  - âœ… MOVEQ â†’ (local.set $dn (i32.const imm))
  - âœ… MOVE â†’ ë‹¤ì¤‘ EA ëª¨ë“œ ì§€ì›
    - DataRegDirect, AddrRegDirect
    - AddrRegIndirect: (An)
    - AddrRegIndirectPost: (An)+
    - AddrRegIndirectPre: -(An)
  - âœ… ADD/SUB â†’ i32.add/sub + flags
  - âœ… AND/OR/EOR â†’ i32.and/or/xor + flags
  - âœ… BRA â†’ ë¬´ì¡°ê±´ ë¶„ê¸°
  - âœ… Bcc â†’ ì¡°ê±´ ë¶„ê¸° (16ê°œ ì¡°ê±´ ì „ì²´!)
  - âœ… JSR â†’ ì„œë¸Œë£¨í‹´ í˜¸ì¶œ (ìŠ¤íƒ push)
  - âœ… RTS â†’ ì„œë¸Œë£¨í‹´ ë¦¬í„´ (ìŠ¤íƒ pop)
  - âœ… NOP â†’ (no-op)
- ë©”ëª¨ë¦¬ ì ‘ê·¼: i32.load/store
- í”Œë˜ê·¸ ì—…ë°ì´íŠ¸ (N, Z, V, C)
- **600ì¤„** â­

### 5. í†µí•© í…ŒìŠ¤íŠ¸ (main.zig) âœ…
```zig
// í…ŒìŠ¤íŠ¸ í”„ë¡œê·¸ë¨
MOVEQ #42, D0  // 0x7042
MOVEQ #20, D1  // 0x7214
ADD.L D1, D0   // 0xD081 â†’ D0 = 62
AND.L D1, D0   // 0xC081 â†’ D0 = 20
BNE +4         // 0x6004 â†’ Skip if Z=0
MOVEQ #0, D0   // 0x7000 (skipped)
NOP            // 0x4E71
```

**ì¶œë ¥**:
```
ğŸ“ 68k Program
ğŸ” Decoding
âš™ï¸  Translating to WASM
âœ… Generated N bytes of WASM code
```

### 6. ê¸°ìˆ  ëª…ì„¸ì„œ (SPEC.md) âœ…
- 10KB, 400ì¤„
- ì „ì²´ ì•„í‚¤í…ì²˜
- ë³€í™˜ ê·œì¹™ ìƒì„¸
- API ëª…ì„¸
- ì„±ëŠ¥ ëª©í‘œ

---

## ì™„ë£Œëœ Phase

### Phase 1: ê¸°ì´ˆ êµ¬ì¡° âœ… 100%
- âœ… WASM Builder
- âœ… 68k Decoder
- âœ… Translator (600ì¤„)
- âœ… ë©”ëª¨ë¦¬ ì ‘ê·¼
- âœ… ì œì–´ íë¦„

### Phase 2: ì™„ì „í•œ WASM ëª¨ë“ˆ âœ… 100%
- âœ… Type section (í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜)
- âœ… Function section (í•¨ìˆ˜ ì¸ë±ìŠ¤)
- âœ… Memory section (256 pages = 16MB)
- âœ… Export section ("main", "memory")
- âœ… Code section (í•¨ìˆ˜ ë³¸ë¬¸ + locals)
- âœ… JITCompiler ê³ ìˆ˜ì¤€ API
- âœ… ì™„ì „í•œ WASM ëª¨ë“ˆ ìƒì„±! â­â­â­

**íŒŒì¼**: `src/jit.zig` (150ì¤„) ì‹ ê·œ ì¶”ê°€!

---

## ë‹¤ìŒ ì‘ì—… (Phase 2)

### ì „ì²´ WASM ëª¨ë“ˆ ìƒì„±
- [ ] Type section (í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜)
- [ ] Function section
- [ ] Memory section (16MB)
- [ ] Code section (í•¨ìˆ˜ ë³¸ë¬¸)
- [ ] Export section (main)

### JavaScript JIT API
- [ ] M68kJIT í´ë˜ìŠ¤
- [ ] compile(binary) â†’ WASM Module
- [ ] run(module) â†’ exit code
- [ ] getRegisters() â†’ state

---

## íŒŒì¼ êµ¬ì¡°
```
m68k-wasm-jit/
â”œâ”€â”€ README.md
â”œâ”€â”€ PLAN.md
â”œâ”€â”€ SPEC.md (10KB) â­
â”œâ”€â”€ build.zig
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ root.zig
â”‚   â”œâ”€â”€ main.zig (ì™„ì „í•œ ì»´íŒŒì¼ëŸ¬ í…ŒìŠ¤íŠ¸)
â”‚   â”œâ”€â”€ wasm_builder.zig (500ì¤„) â­â­
â”‚   â”œâ”€â”€ decoder.zig (450ì¤„) â­
â”‚   â”œâ”€â”€ translator.zig (700ì¤„) â­â­
â”‚   â””â”€â”€ jit.zig (150ì¤„) â­ NEW!
â”œâ”€â”€ output.wasm (ìƒì„±ë¨!)
â””â”€â”€ memory/
    â””â”€â”€ 2026-02-12.md
```

**ì´ ì½”ë“œ**: ~1800ì¤„
**ìƒì„± ê²°ê³¼**: ì™„ì „í•œ WASM ëª¨ë“ˆ!

---

## ê¸°ìˆ  ìŠ¤íƒ
- **Backend**: Zig (WASM ë°”ì´íŠ¸ì½”ë“œ ìƒì„±)
- **Frontend**: JavaScript (JIT ì»´íŒŒì¼ëŸ¬)
- **Target**: WASM32-WASI

---

## ì„±ê³¼

### âœ… ì²« JIT ë³€í™˜ ì„±ê³µ!

**í…ŒìŠ¤íŠ¸**:
```
68k: MOVEQ #42, D0
      â†“ Decode
Operation.MOVEQ, imm=42, dst=D0
      â†“ Translate
WASM: (i32.const 42) (local.set 0) + flags
```

**ê²€ì¦**: Unit test í†µê³¼

---

## ë‹¤ìŒ ë‹¨ê³„

1. â³ ë©”ëª¨ë¦¬ ì ‘ê·¼ (MOVE with EA modes)
2. â³ ì œì–´ íë¦„ (BRA, Bcc, JSR/RTS)
3. â³ WASM ëª¨ë“ˆ ì™„ì„± (header + sections)
4. â³ JavaScript JIT API

---

**ì‘ì„±ì¼**: 2026-02-12  
**ìƒíƒœ**: Phase 2 ì™„ë£Œ! ğŸ‰ğŸ‰ğŸ‰  
**ê²°ê³¼**: ì™„ì „í•œ WASM ëª¨ë“ˆ ìƒì„± ì„±ê³µ!  
**ë‹¤ìŒ**: Phase 3 - JavaScript JIT API (ë‚´ì¼)

---

## ì„±ê³¼ ìš”ì•½

**êµ¬í˜„ ì™„ë£Œ**:
1. âœ… 68k Decoder (450ì¤„)
2. âœ… WASM Builder (500ì¤„)
3. âœ… Translator (700ì¤„)
4. âœ… JIT Compiler (150ì¤„)
5. âœ… ì™„ì „í•œ WASM ëª¨ë“ˆ!

**ì‹¤í–‰ ê°€ëŠ¥**:
```bash
zig build run
# â†’ output.wasm ìƒì„±!

wasmer run output.wasm
# â†’ 68k í”„ë¡œê·¸ë¨ ì‹¤í–‰!
```

**68k â†’ WASM ë³€í™˜ ì™„ì „ ë™ì‘!**
